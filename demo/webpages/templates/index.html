{% extends 'uhf.html' %}

{% block title %} Unite {% endblock %}
{% load static %}

{% block content %}


<link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css"
   integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
   crossorigin=""/>

<script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"
   integrity="sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg=="
   crossorigin=""></script>
   
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>

   <div id="mapid" style="height: 650px;"></div>
   <input type="text" id="searchbox"></input>
   <button id="searchbut">Click me</button>

   <script> var mymap = L.map('mapid').setView([51.505, -0.09], 2); 
    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1Ijoic3NnY2lkIiwiYSI6ImNqdWJzaHB2NzBndDE0NHBnaHpxaDFrcGIifQ.EcaaA2KHlVOmpx5_Y4P5ow', {
        attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
        maxZoom: 9,
        id: 'mapbox.streets',
        accessToken: 'pk.eyJ1Ijoic3NnY2lkIiwiYSI6ImNqdWJzaHB2NzBndDE0NHBnaHpxaDFrcGIifQ.EcaaA2KHlVOmpx5_Y4P5ow'
    }).addTo(mymap);

    function getSeattle(feature) {
        // console.log(feature.properties.POPULATION);
        return feature.properties.POPULATION > 6000000.0;
    }
    var search;
    function onClickSearch() {
        var input = document.getElementById('searchbox').value;
        $.getJSON("{% static "citydatatest.geojson" %}", function(data){
            if (typeof search != "undefined") {
                search.clearLayers();
            }
            var selected;
            search = L.geoJson(data, {filter: function(feature) {
                selected = feature;
                if (feature.properties.NAME_2 == null) {
                    return false;
                }
                return feature.properties.NAME_2.toLowerCase() == input.toLowerCase();
            }}).addTo(mymap).on('click', function() {useLocation(selected);});
            mymap.fitBounds(search.getBounds());
        });
    }
    function useLocation(selected) {
        $.getJSON("{% static "citydatatest.geojson" %}", function(data){
            if (typeof search != "undefined") {
                search.clearLayers();
            }
            search = L.geoJson(data, {filter: function(feature) {
                return ((feature.properties.POPULATION > (selected.properties.POPULATION * 0.99) && 
                        feature.properties.POPULATION < (selected.properties.POPULATION * 1.02))) || 
                        feature.properties.HASC_2 == selected.properties.HASC_2;
            }}).addTo(mymap);
            mymap.fitBounds(search.getBounds());
        });
    }
    document.getElementById("searchbut").onclick = onClickSearch;
    
    
    </script>
    
   

{% endblock %}